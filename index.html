<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/ced16bdd19.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <link rel='stylesheet' href='./index.css'>
    <title>Todo</title>
</head>

<body>
    <main>
        <section id='upperContainer' class='borders d-flex justify-content-between '>
            <section class='borders card border-light mb-3' style='width:100%'>
                <strong class='card-header'>Work to do today</strong>
                <article id='todayTodos' class='card-body'>
                    <!-- <h1>todo</h1>
                    <h1>todo</h1>
                    <h1>todo</h1>
                    <h1>todo</h1>
                    <h1>todo</h1>
                    <h1>todo</h1>
                    <h1>todo</h1> -->
                </article>

                <strong class='card-header'>completed</strong>
                <article id="completed-todo" class='card-body'>

                </article>


            </section>
            <article id='progressContainer' class='borders'>
                <div class='progress circle'>
                    <!-- <div class="progress-bar w-75 circle" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div> -->
                </div>

            </article>
        </section>
        <section id='lowercontainer' class='borders d-flex'>
            <section id='addTodo' class='bg-blue'>
                <article class='card border-success m-3'>
                    <img class='card-img-top' alt=''>
                    <strong class='card-header '>Add a note</strong>
                    <article class='card-body bg-light'>
                        <form id='todoForm' style=' height:10rem'>
                            <button type='button' class='btn btn-primary btn' value='today'> Today
                            </button>
                            <strong class='btn'> Scheduled for : </strong>
                            <select name='day' class='btn-sm'>
                                <option>Today</option>
                                <option>Monday</option>
                                <option>Tuesday</option>
                                <option>Wednesday</option>
                                <option>Thursday</option>
                                <option> Friday </option>
                                <option>saturday</option>
                                <option>sunday</option>
                            </select>
                            <hr />
                            <br />
                            <input name='text' type='text' class=''
                                style='border:none; border-bottom: 2px solid red; height: 1.5rem; padding: 0 0.5rem; font-size: 1.0rem;'
                                placeholder='What to do?'>
                            <button id='submitForm' type='button' class=' btn btn-success btn-sm'>Add</button>
                            <button type='button' class=' btn btn-danger btn-sm'>Cancel</button>
                        </form>
                    </article>
                </article>
            </section>
            <section class='borders d-flex'>
                <article>
                    <button type='button' class='btn-info btn-sm mt-3 ml-3'>Prev</button>
                </article>
                <article class='card text-white ml-3 mr-3 bg-secondary' style='width:20rem'>
                    <strong class='card-header'>Tomorrow</strong>
                    <article id='upcoming' class='card-body'>
                        <!-- <h1>hiiii</h1>
                        <h1>hiiii</h1>
                        <h1>hiiii</h1>
                        <h1>hiiii</h1>
                        <h1>hiiii</h1> -->
                    </article>

                </article>
                <article>
                    <button type='button' class='btn btn-sm btn-info mt-3 mr-3'>next</button>
                </article>
            </section>
        </section>
    </main>
    <!-- <script src='./jq.js'>
                    </script> -->
    <script>
        $(document).ready(function () {
            init();
            const todos = JSON.parse(localStorage.getItem('todos'));

            //[
            // { text: 'feed cat', day: 'Monday', done: false },
            // { text: 'feed dog', day: 'Tuesday', done: false },
            // { text: 'feed parrot', day: 'Wednesday', done: false },
            // { text: 'feed monkey', day: 'Thursday', done: false },
            // { text: 'feed horse', day: 'Friday', done: false },
            // { text: 'feed cow', day: 'Saturday', done: false },
            // { text: 'feed donkey', day: 'Saturday', done: false },
            // { text: 'feed rabbit', day: 'Sunday', done: false },
            // { text: 'feed Lion', day: 'Sunday', done: false },
            // { text: 'the buffolow', day: 'Monday', done: false },
            // { text: 'feed tiger', day: 'Saturday', done: false },
            // { text: 'feed elephant', day: 'Sunday', done: false }

            //];
            $('#submitForm').click(function () {

                const weeks = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

                const form = $('#todoForm').serializeArray();
                console.log(form);
                const day = form[0].value === 'Today' ? weeks[new Date().getDay()] : form[0].value
                const todo = {
                    text: form[1].value,
                    day: day,
                    done: false
                }
                createTodo(todo);
                console.log(todos)

                init();

            });

            function init() {
                $('#todayTodos').html('');
                $('#upcoming').html('');
                $('#completed-todo').html('')
                try {
                    const todos = JSON.parse(localStorage.getItem('todos'));
                    const Day = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
                    const today = Day[new Date().getDay()];
                    const tomorrow = ((new Date().getDay()) + 1) === 7 ? Day[0] : Day[new Date().getDay() + 1]

                    todos.map((item, index, arr) => {
                        if (item.day === today) {
                            if (item.done === false) {
                                const task = $(`<article class='todo border d-flex justify-content-between ' style='font-size:1.2rem'></article>`).text(item.text)

                                const check = $("<i class='fas fa-check mr-3'></i>").click(function () {
                                    var selectedTodo = $(this).parent().parent();
                                    selectedTodo.fadeOut(1000, function () {
                                        // $('#completed-todo').append(selectedTodo.text());
                                        done(selectedTodo.text());
                                        // selectedTodo.fadeIn(1000);
                                        selectedTodo.remove();
                                    });

                                });
                                const del = $("<i class='fas fa-trash-alt '></i>").click(function () {
                                    var selectedTodo = $(this).parent().parent();
                                    selectedTodo.fadeOut(1000, function () {
                                        deleteTodo(selectedTodo.text());
                                        selectedTodo.remove();
                                    })

                                });
                                const action = $("<div class='mr-3'>").append(check, del)
                                task.append(action);
                                // $('#todayTodos').append(`<h1>${item.text}</h1>done":true`)
                                $('#todayTodos').append(task);
                            }
                            else {
                                moveToDone(item)
                            }

                        }
                        if (item.day === tomorrow) {
                            const task = $("<article class'd-flex justify-content-between' style='font-size:1.2rem></article>").text(item.text);
                            const del = $("<i class='fas fa-trash-alt '></i>").click(function () {
                                const seletedTodo = $(this).parent();
                                seletedTodo.fadeOut(1000, function () {
                                    deleteTodo(seletedTodo.text())
                                    seletedTodo.remove();
                                })
                            })
                            task.append(del);
                            $('#upcoming').append(task)
                        }
                    });
                } catch (e) { console.log(e) }
            }

            function createTodo(todo) {
                todos.push(todo);
                localStorage.setItem('todos', JSON.stringify(todos));
            }

            function done(text) {
                // console.log(text)
                try {
                    const todos = JSON.parse(localStorage.getItem('todos'));
                    //console.log(todos)
                    const newTodos = todos.map(todo => {
                        if (todo.text == text) {
                            todo.done = true;
                            moveToDone(todo);
                            console.log(todo)
                        }
                        return todo;
                    });
                    localStorage.setItem('todos', JSON.stringify(newTodos));

                } catch (e) {

                }
            }

            function moveToDone(todo) {
                const task = $(`<article class='todo border d-flex justify-content-between' style='font-size:1.2rem'></article>`).text(todo.text);
                const del = $("<i class='fas fa-trash-alt '></i>").click(function () {
                    const seletedTodo = $(this).parent();
                    seletedTodo.fadeOut(1000, function () {
                        deleteTodo(seletedTodo.text())
                        seletedTodo.remove();
                    })
                });
                task.append(del);
                $('#completed-todo').append(function () {
                    return (task.fadeIn(1000))
                });

            }

            function deleteTodo(text) {
                // console.log(text)
                try {
                    const todos = JSON.parse(localStorage.getItem('todos'));
                    //console.log(todos)
                    const newTodos = todos.filter(todo => todo.text !== text);
                    localStorage.setItem('todos', JSON.stringify(newTodos));

                } catch (e) {

                }
            }
        });
    </script>

</body>

</html>